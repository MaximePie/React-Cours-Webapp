<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8"/>
    <title>Hello React</title>
    <!-- Library -->
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>

    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

    <!-- babel => compilation du JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>
<div id="root"></div>
<script type="text/babel">

    // Création de composant en créant des classes
    class Hello extends React.Component {

        constructor() {
            super();

            this.state = {
                legumes: [
                    {
                        name: "Courgette",
                        draftName: "", // DraftName contient la valeur de l'input destiné à faire changer de nom à l'aliment.
                        prix: 5,
                    },
                    {
                        name: "Popotiron",
                        draftName: "",
                        prix: 155,
                    },
                    {
                        name: "Baba",
                        draftName: "",
                        prix: 99,
                    },
                    {
                        name: "Carotte",
                        draftName: "",
                        prix: 1,
                    }
                ],
                newVegetableName: "",
                newVegetablePrice: "",
            };

            this.handleVegetableNameChange = this.handleVegetableNameChange.bind(this);
            this.handleVegetablePriceChange = this.handleVegetablePriceChange.bind(this);
            this.addVegetable = this.addVegetable.bind(this);
            this.deleteVegetable = this.deleteVegetable.bind(this);
            this.changeVegetableName = this.changeVegetableName.bind(this);
        }

        render() {
            return (
                <div>
                    <p>Je vous invite à lire ceci : <a
                        href="https://www.robinwieruch.de/react-state-array-add-update-remove">Comment gérer les états
                        avec les tableaux en React</a></p>
                    <ul>
                        <li>Afficher la liste des légumes. Pour chaque légume, afficher son nom et son prix</li>
                        <li>Pour chaque légume, afficher un input de type texte qui prendra comme valeur sa draftName
                        </li>
                        <li>Créer une méthode changeVegetableName, qui prend en paramètre un nouveau nom, et un index de
                            légume à modifier.
                        </li>
                        <li>Pour chaque légume, créer un bouton qui va appeler changeVegetableName en lui envoyant
                            l'index du légume à modifier
                        </li>
                        <li>La méthode changeVegetableName doit pouvoir identifier le légume dont le nom doit changer,
                            mettre à jour son nom et remettre sont draftName à ""
                        </li>
                    </ul>
                    <ul>
                        <li>Créer une méthode deleteVegetable, qui prend en paramètre un index de tableau, et qui
                            supprime cet élément du tableau en mettant le state à jour
                        </li>
                        <li>Pour chaque légume, créer un bouton "supprimer" qui va appeler la méthode deleteVegetable,
                            en lui envoyant comme paramètre l'index du légume
                        </li>
                    </ul>
                    <ul>
                        <li>Créer deux propriétés de state : Une propriété 'newVegetableName' de type String, et une
                            propriété 'newVegetablePrice' de type String
                        </li>
                        <li>Créer une méthode addVegetable qui va créer un nouveau légume en se basant sur la valeur de
                            ces deux propriétés
                        </li>
                        <li>Créer un petit formulaire composé de deux input, un input pour le nom du légume, et un autre
                            pour le prix du légume.
                        </li>
                        <li>Chaque input doit être lié au state correspondant. L'input pour le nom du légume doit être
                            lié à newVegetableName et l'input pour le type à newVegetablePrice
                        </li>
                        <li>Créer un bouton qui déclenche la fonction addVegetable</li>
                    </ul>
                    <div>
                        {this.state.legumes.map((legume, index) => (
                            <div key={index}>
                                <p>Nom : {legume.name}</p>
                                <p>Prix : {legume.prix}</p>
                                <p>{legume.draftName}</p>
                                <input
                                    type="text"
                                    value={legume.draftName}
                                    onChange={(event) => this.updateDraftName(index, event.target.value)}
                                />
                                <button onClick={() => this.changeVegetableName(index)}>Enregistrer</button>
                                <button onClick={() => this.deleteVegetable(index)}>Supprimer</button>
                            </div>
                        ))}
                    </div>
                    <div>
                        <form onSubmit={this.addVegetable}>
                            <input
                                value={this.state.newVegetableName}
                                name="newVegetableName"
                                onChange={this.handleVegetableNameChange}
                            />
                            <input
                                value={this.state.newVegetablePrice}
                                name="newVegetablePrice"
                                onChange={this.handleVegetablePriceChange}
                            />
                            <button> Enregistrer </button>
                        </form>
                    </div>
                </div>
            )
        }

        /**
         * Mettre à jour le state du draftname du légume ciblé par l'index
         */
        updateDraftName(index, draftname) {

            const legumes = this.state.legumes;

            legumes[index].draftName = draftname;

            this.setState({
                legumes
            })
        }

        /**
         * Mettre à jour le state pour changer le nom d'un légume correspondant à l'index donné
         */
        changeVegetableName(newIndex) {
            const legumes = this.state.legumes;

            const updatedLegume = legumes[newIndex];

            updatedLegume.name = updatedLegume.draftName;

            updatedLegume.draftName = '';

            legumes.map(function(legume, index) {
                if (index === newIndex) {
                    return updatedLegume
                }
                else {
                    return legume
                }
            })

            this.setState({
                legumes
            })

        }

        /**
         * Retirer le légume ciblé
         */
        deleteVegetable(toDeleteIndex) {
            const legumes = this.state.legumes;

            const updatedLegumes = legumes.filter((legume, legumeIndex) => legumeIndex !== toDeleteIndex)

            this.setState({
                legumes: updatedLegumes,
            })
        }

        /**
         * Met à jour le champ suivant le name contenu dans le target de l'event
         * La valeur est égale à la value du target de l'event
         * @param event Event l'événement d'input qui contient les informations de changement de valeur
         */
        handleVegetableNameChange(event) {
            this.setState({
                newVegetableName: event.target.value
            })
        }

        /**
         * Met à jour le champ suivant le name contenu dans le target de l'event
         * La valeur est égale à la value du target de l'event
         * @param event Event l'événement d'input qui contient les informations de changement de valeur
         */
        handleVegetablePriceChange(event) {
            this.setState({
                newVegetablePrice: event.target.value
            })
        }

        /**
         * Mettre à jour le state des légumes en créant un nouveau légume
         * @param event
         */
        addVegetable(event) {
            event.preventDefault();
            const newLegume = {
                name: this.state.newVegetableName,
                prix: this.state.newVegetablePrice,
                draftName: ""
            };

            console.log(newLegume);

            const listeLegumes = this.state.legumes;
            listeLegumes.push(newLegume)

            this.setState({
                legumes: listeLegumes,
            })
        }
    }

    // Rendu dans le DOM
    ReactDOM.render(
        <Hello/>,
        document.getElementById('root')
    );
</script>
</body>

</html>
